# 🚨 AIO Hub ロールバックプラン

**作成日時**: 2025-09-22 20:58:00 JST  
**対象環境**: Production (aiohub.jp)  
**現在のデプロイ**: commit 589b849 (UAT Final System)

## 📋 ロールバック判断基準

### 🚨 即座にロールバックが必要な場合
- [ ] 本番サイトが完全にダウン (5xx エラーが継続)
- [ ] データベース接続の完全な失敗
- [ ] セキュリティ脆弱性の発見
- [ ] 重要なビジネス機能の完全停止

### ⚠️ ロールバックを検討する場合  
- [ ] API エラー率が50%を超過
- [ ] 認証機能の重大な障害
- [ ] パフォーマンス劣化が著しい (応答時間10秒超え)
- [ ] ユーザーからの苦情が多数

## 🔄 ロールバック手順

### ステップ1: 緊急停止 (必要に応じて)
```bash
# Vercel デプロイメントの一時停止
npx vercel --confirm --force
```

### ステップ2: 安定版への復旧
前回の安定バージョン: **commit 8070a95** (Stripe setup fee feature)

```bash
# 1. ローカルでの復旧作業
git checkout main
git reset --hard 8070a95

# 2. 強制プッシュでのロールバック
git push origin main --force

# 3. Vercel 自動デプロイ確認
# Vercel ダッシュボードでデプロイ状況を監視
```

### ステップ3: 検証手順
```bash
# 基本的な動作確認
curl -I https://aiohub.jp
curl -I https://aiohub.jp/auth/login
curl -I https://aiohub.jp/organizations

# パフォーマンス確認  
curl -w "@curl-format.txt" -o /dev/null -s https://aiohub.jp
```

### ステップ4: 関係者への通知
1. **Slack/Teams通知**  
2. **ユーザー向けお知らせ** (必要に応じて)
3. **ステークホルダー報告**

## 📊 ロールバック影響分析

### 失われる機能
- ✅ **UAT自動化システム**: 開発者向け機能のため影響軽微
- ✅ **認証ページ改善**: 既存ログイン機能は維持
- ✅ **ドキュメント追加**: 運用に直接影響なし

### 維持される機能
- ✅ **基本的な企業情報表示**
- ✅ **検索機能**  
- ✅ **既存の認証システム**
- ✅ **Stripe決済機能**
- ✅ **メール送信機能**

## 🔍 ロールバック後の対応

### 即座に実施
1. **基本機能の動作確認** (15分)
2. **パフォーマンス監視開始** (継続)
3. **エラーログ収集** (24時間)

### 24時間以内
1. **根本原因分析**
2. **修正版の開発着手**  
3. **再デプロイ計画策定**

### 週内対応
1. **包括的テストの実施**
2. **段階的リリース計画**
3. **監視体制の強化**

## 🛠️ 緊急連絡先・コマンド

### 緊急時クイックコマンド
```bash
# 最短ロールバック (1コマンド)
git reset --hard 8070a95 && git push origin main --force

# Vercel 状況確認
npx vercel ls
npx vercel inspect [deployment-url]

# 環境変数確認  
npx vercel env ls

# ログ確認
npx vercel logs [deployment-url]
```

### Vercel ダッシュボードリンク
- **プロジェクト**: https://vercel.com/dashboard  
- **デプロイメント履歴**: [Vercel Deployments]
- **ドメイン設定**: [Vercel Domains]

## 📝 ロールバック実行ログ

**実行者**: ________________  
**実行日時**: ________________  
**選択した手順**: ________________  
**完了時刻**: ________________  
**検証結果**: ________________  

---

**このプランの更新**: 次回デプロイ時に最新化  
**保存場所**: `scripts/uat/output/rollback-plan-20250922.md`