PR1 適用内容（貼り付けて実装 → 検証まで）
以下を順に反映してください。完了後に型チェック・ビルド・最小動作確認を実施します。

1) 型付き Admin クライアントを新規追加
追加: src/lib/supabase/adminClient.ts
import
 { createClient } 
from
 
'npm:@supabase/supabase-js@2.46.1'

import
 
type
 { Database } 
from
 
'@/types/supabase'
 
// or 'src/types/supabase'

if
 (!process.env.SUPABASE_URL || !process.env.SUPABASE_SERVICE_ROLE_KEY) {
  
throw
 
new
 
Error
(
'Missing SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY'
)
}
export
 
const
 supabaseAdmin = createClient<Database>(
  process.env.SUPABASE_URL,
  process.env.SUPABASE_SERVICE_ROLE_KEY,
  {
    
auth
: { 
persistSession
: 
false
 },
    
global
: { 
headers
: { 
'X-Client-Name'
: 
'admin-api'
 } },
  }
)

ポイント

Database 型を適用
persistSession: false でサーバー実行に最適化
2) 型ユーティリティ（任意だが推奨）
追加: src/lib/types/supabase-helpers.ts
import type { Database } from '@/types/supabase'
export type OrgGroupMember = Database['public']['Tables']['org_group_members']['Row']
export type OrgGroupInvite = Database['public']['Tables']['org_group_invites']['Row']
export type OrgGroupJoinRequest = Database['public']['Tables']['org_group_join_requests']['Row']

3) org-groups 配下の as any 除去と select の明示
以下は代表的な変更例です。パスが異なる場合は該当ファイルに合わせて適用してください。

変更: src/app/api/admin/org-groups/join-requests/[requestId]/route.ts
編集点

import の追加
import { supabaseAdmin } from '@/lib/supabase/adminClient'
import type { OrgGroupJoinRequest } from '@/lib/types/supabase-helpers'（任意）
置換
(supabaseAdmin as any) → supabaseAdmin
select の明示（Row に合わせて必要最小）
'id, group_id, organization_id, status, invite_code, requested_by, decided_by, decided_at, created_at, updated_at'
RPC 呼び出しの戻り値ハンドリングを明確化
差分イメージ（要点）

- 
const
 { data, error } = 
await
 (supabaseAdmin 
as
 any)
-   .
from
(
'org_group_join_requests'
)
-   .
select
(
'*'
)
+ 
const
 { data, error } = 
await
 supabaseAdmin
+   .
from
(
'org_group_join_requests'
)
+   .
select
(
'id, group_id, organization_id, status, invite_code, requested_by, decided_by, decided_at, created_at, updated_at'
)
    .eq(
'id'
, requestId)
    .maybeSingle()
  
// 承認処理

- 
const
 rpcRes = 
await
 (supabaseAdmin 
as
 any).rpc(
'approve_join_request'
, { p_request_id: requestId, p_invite_code: inviteCode })
+ 
const
 rpcRes = 
await
 supabaseAdmin.rpc(
'approve_join_request'
, {
+   p_request_id: requestId,
+   p_invite_code: inviteCode,
+ })
  
if
 (rpcRes.error) {
-   
return
 NextResponse.json({ error: rpcRes.error }, { status: 
400
 })
+   
return
 NextResponse.json({ error: rpcRes.error.message }, { status: 
400
 })
  }

変更: src/app/api/admin/org-groups/invites/route.ts
編集点

import { supabaseAdmin } from '@/lib/supabase/adminClient'
(supabaseAdmin as any) → supabaseAdmin
select 列の明示
取得: 'id, group_id, code, expires_at, max_uses, used_count, created_by, note, created_at, revoked_at'
作成/更新後の返却は 'id, code, used_count' など必要最小
差分イメージ

- 
const
 { data, error } = 
await
 (supabaseAdmin 
as
 any)
-  .
from
(
'org_group_invites'
)
-  .
select
(
'*'
)
+ 
const
 { data, error } = 
await
 supabaseAdmin
+  .
from
(
'org_group_invites'
)
+  .
select
(
'id, group_id, code, expires_at, max_uses, used_count, created_by, note, created_at, revoked_at'
)
   .eq(
'group_id'
, groupId)
- 
const
 { data: created, error: createErr } = 
await
 (supabaseAdmin 
as
 any)
+ 
const
 { data: created, error: createErr } = 
await
 supabaseAdmin
   .
from
(
'org_group_invites'
)
   .insert(payload)
-  .
select
(
'*'
)
+  .
select
(
'id, code, used_count'
)
   .maybeSingle()

変更: src/app/api/admin/org-groups/members/route.ts
編集点

import { supabaseAdmin } from '@/lib/supabase/adminClient'
(supabaseAdmin as any) → supabaseAdmin
select 列の明示: 'id, group_id, organization_id, role, created_at'
差分イメージ

- 
const
 { data, error } = 
await
 (supabaseAdmin 
as
 any)
+ 
const
 { data, error } = 
await
 supabaseAdmin
   .
from
(
'org_group_members'
)
-  .
select
(
'*'
)
+  .
select
(
'id, group_id, organization_id, role, created_at'
)
   .eq(
'group_id'
, groupId)

共通のエラーハンドリング調整（PostgrestError）
- if (error) return NextResponse.json({ error }, { status: 
400
 })
+ if (error) return NextResponse.json({ error: error.message }, { status: 
400
 })

4) 実行と検証
コマンド

npm run typecheck
npm run build
手動チェック（最小）

join-requests 承認: approve_join_request RPC成功、org_group_members 追加、join_requests.status = approved
join-requests 失敗: 無効 invite_code で 400/409 を返す
invites 一覧/作成が正常
members 一覧/削除が正常
5) コミット＆プッシュ
git add -A
git commit -m "refactor(org-groups): remove as any; add typed admin client; narrow select columns"
git push
検証結果を共有してください。

typecheck/build の結果
上記3つの手動チェックの可否とエラーメッセージ（ある場合）
問題があれば、その場で差分修正案を即時提示します。PR1が安定したら、次はPR2（admin/alerts 配下の as any 除去）に進みます。

