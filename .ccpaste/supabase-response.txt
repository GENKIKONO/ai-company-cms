You are Claude Code working in a Next.js + Supabase + Vercel repo.

GOAL
- Prepare a production release by (1) applying DB migrations to production, then (2) pushing to origin/main to trigger Vercel.
- Do NOT change any UI/feature behavior in this task. This task is release orchestration only.

STRICT RULES
- No new features. No refactors. No style/UI changes. No "cleanup".
- Only allowed changes: release notes / docs for release, and scripts that help release safety (but prefer zero code changes).
- If any unexpected diffs are found, STOP and report clearly instead of "fixing".

STEP 0: REPO STATE CHECK (must output)
1) Print:
   - git status (short)
   - current branch
   - last 5 commits (oneline)
2) Count how many files changed and list top-level directories affected.
3) Identify whether there are DB migrations staged/unstaged:
   - Look for supabase/migrations/*.sql
   - Summarize each migration filename and what it does (short).

STEP 1: VERIFY BUILD / ARCHITECTURE GUARDS (must run)
Run and report results:
- npm run typecheck
- npm run check:architecture
If either fails: STOP and report.

STEP 2: DB CHANGE DECISION (must be explicit)
If there is at least one new migration file that is not yet applied to production:
- Set DB_CHANGE = YES
Else:
- Set DB_CHANGE = NO

STEP 3: PRODUCE A SAFE RELEASE PLAN (must output as checklist)
Output a checklist with exact commands, in the correct order:

If DB_CHANGE = YES:
A) Confirm Supabase project linkage (show the command you will use to verify).
B) Apply migrations to production using:
   npx supabase db push --linked
C) After DB push, re-run:
   npm run typecheck
   npm run check:architecture
D) Commit (if there are uncommitted changes intended for release)
E) Push:
   git push origin main
F) Provide post-deploy verification checklist (URLs and key flows).
G) Provide rollback plan:
   - Code rollback (git revert)
   - DB rollback note (explain that DB rollback needs a down migration or manual revert).

If DB_CHANGE = NO:
Skip DB steps and proceed with commit+push.

STEP 4: RELEASE NOTES (must output)
Create a concise RELEASE_NOTES.md draft (do not add it to git unless asked).
Include:
- Scope summary (what changed)
- Verification commands passed
- DB change summary (YES/NO, migration names)
- Known risks (short)
- Manual smoke checks

STEP 5: VERCEL DOES NOT DEPLOY TROUBLESHOOT (must output)
If Vercel still does not trigger after pushing:
Provide a short checklist to verify:
- Vercel project connected to correct GitHub repo
- Production branch is main
- Git integration is active
- "Deploy Hooks" if used
- Vercel build logs location

FINAL OUTPUT FORMAT
- "DB_CHANGE: YES/NO"
- "READY_TO_PUSH: YES/NO" (YES only if checks passed)
- Command checklist
- Release notes draft
- Troubleshooting checklist
- Nothing else
