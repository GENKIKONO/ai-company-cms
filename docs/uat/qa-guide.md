# 🎯 QA担当者向けUATリハーサルガイド

本番環境でのユーザー受け入れテスト（UAT）を安全かつ効率的に実行するためのQA担当者向け完全ガイドです。

## 📋 事前準備チェックリスト

### 🔐 アクセス権限の確認

- [ ] GitHub リポジトリへの読み取り権限
- [ ] 本番環境 https://aiohub.jp へのアクセス権限  
- [ ] テスト用アカウント情報の準備
- [ ] Slack/Discord通知チャンネルの確認

### 💻 ローカル環境セットアップ

```bash
# 1. リポジトリクローン（初回のみ）
git clone [repository-url]
cd LuxuCare株式会社/開発

# 2. 依存関係インストール
npm install

# 3. UAT環境確認
npm run uat:env-check
```

### 📧 テスト用アカウント準備

#### メールアドレス（Resendテスト用）
- `test@example.com`
- `qa-team@example.com` 
- `uat-test@example.com`

#### Stripe決済テストカード
```
カード番号: 4242 4242 4242 4242
有効期限: 12/34
CVC: 123
```

## 🚀 UAT実行手順

### 1️⃣ 事前チェック（必須）

```bash
# DNS/SSL/API疎通確認
npm run uat:preflight
```

**期待する結果**: 全3項目が `✅ PASS`

**失敗時の対応**:
- ログファイル確認: `scripts/uat/output/`
- 開発チームに問題レポート作成
- 修正完了まで後続テスト中止

### 2️⃣ クリティカルテスト（40分 - 必須）

```bash
# クリティカルテスト開始
npm run uat:critical
```

#### テスト項目と所要時間

| No | テスト項目 | 所要時間 | 必須度 |
|----|-----------|----------|--------|
| 1 | 基本認証フロー | 10分 | 🔴 必須 |
| 2 | 企業作成→公開 | 15分 | 🔴 必須 |  
| 3 | 決済→サブスクリプション | 10分 | 🔴 必須 |
| 4 | セキュリティ基本確認 | 5分 | 🔴 必須 |

**🎯 成功基準**: 4/4項目すべて成功（リリース可能）
**⚠️ 失敗基準**: 1項目でも失敗（リリース延期）

### 3️⃣ 重要テスト（110分 - 推奨）

```bash
# 重要テスト開始（クリティカル成功後）
npm run uat:important
```

#### テスト項目詳細

| No | テスト項目 | 所要時間 | 内容 |
|----|-----------|----------|------|
| 1 | 全CRUD操作 | 45分 | 企業・記事・ユーザー管理 |
| 2 | 権限別アクセス制御 | 30分 | Admin/Editor/Viewer検証 |
| 3 | メール通知全パターン | 20分 | 登録・更新・削除通知 |
| 4 | データ整合性確認 | 15分 | DB整合性・バックアップ |

### 4️⃣ 推奨テスト（115分 - オプション）

```bash
# 推奨テスト開始（重要テスト成功後）
npm run uat:recommended
```

## 📊 レポート生成と判定

### 自動レポート生成

```bash
# UAT実行結果レポート生成
npm run uat:report
```

**出力先**: `docs/uat/logs/YYYYMMDD/uat-report.md`

### リリース判定基準

#### 🟢 本番リリース可能
- ✅ 事前チェック 3/3 成功
- ✅ クリティカルテスト 4/4 成功
- ✅ 重要テスト完了（推奨）

#### 🟡 条件付きリリース
- ✅ 事前チェック 3/3 成功  
- ✅ クリティカルテスト 4/4 成功
- ⏳ 重要テスト未完了

#### 🔴 リリース延期
- ❌ 事前チェック失敗
- ❌ クリティカルテスト失敗

## 🔧 トラブルシューティング

### よくある問題と対処法

#### DNS/SSL検証失敗
```bash
# DNS状態確認
nslookup aiohub.jp
dig aiohub.jp

# SSL証明書確認  
openssl s_client -connect aiohub.jp:443 -servername aiohub.jp
```

#### API疎通失敗
```bash
# ヘルスチェック確認
curl -I https://aiohub.jp/api/health

# 認証API確認
curl -X POST https://aiohub.jp/api/auth/test
```

#### 決済テスト失敗
- Stripeダッシュボードでテストモード確認
- テストカード番号の再確認
- ブラウザコンソールでエラー確認

#### メール送信失敗  
- Resendダッシュボードでテストモード確認
- スパムフォルダの確認
- メールアドレス形式の確認

### ログファイル確認

```bash
# 最新ログ確認
ls -la scripts/uat/output/

# 特定ログ表示
cat scripts/uat/output/critical-test.log
cat scripts/uat/output/dns-check.log
```

## 🎭 リハーサル実行プラン

### 第1回リハーサル（基本機能確認）

**日時**: 本番1週間前  
**参加者**: QA担当者2名、開発者1名  
**目的**: 手順確認とツール動作検証

**実行内容**:
1. 事前チェック実行 (10分)
2. クリティカルテスト実行 (40分)  
3. レポート生成確認 (5分)
4. 問題点の洗い出し (15分)

### 第2回リハーサル（本番想定）

**日時**: 本番3日前  
**参加者**: QA担当者、開発者、PM  
**目的**: 本番と同じ流れでの完全検証

**実行内容**:
1. 全フェーズテスト実行 (165分)
2. GitHub Actions確認 (10分)
3. 判定・報告プロセス確認 (15分)
4. 最終手順書確定 (20分)

## 📱 GitHub Actions手動実行

### ワークフロー実行方法

1. **GitHubリポジトリにアクセス**
   - `Actions` タブをクリック
   - `UAT Preflight Checks` を選択

2. **手動実行**
   ```
   Run workflow ▼
   - Use workflow from: main
   - Target branch: [テスト対象ブランチ名]
   ```

3. **実行結果確認**
   - ✅ 成功: 緑色チェックマーク
   - ❌ 失敗: 赤色エラーマーク  
   - ログダウンロード: `Artifacts` セクション

### PR自動コメント確認

実行完了後、該当PRに以下形式のコメントが自動投稿されます:

```markdown
## 🧪 UAT Preflight 検証結果

### 📋 事前チェック結果
| チェック項目 | 結果 | 詳細 |
|-------------|------|------|
| ✅ 環境変数チェック | **PASS** | 本番環境設定の検証 |

### 🎯 リリース判定
🟢 **本番リリース可能** / 🔴 **リリース延期**
```

## 🚨 緊急時対応

### クリティカルテスト失敗時

**即座に実行**:
1. テスト中止・環境保全
2. 失敗内容の詳細記録
3. 開発チームへ緊急連絡
4. ステークホルダーへの状況報告

**連絡テンプレート**:
```
【緊急】UAT失敗報告

テスト項目: [失敗項目名]
失敗時刻: [YYYY-MM-DD HH:MM]
エラー内容: [詳細説明]
影響範囲: [リリース延期/部分機能停止等]
対応予定: [修正予定時間]

レポート: docs/uat/logs/[date]/uat-report.md
```

### 本番環境異常検知時

**緊急停止手順**:
1. Vercelダッシュボードで緊急停止
2. 関係者への緊急連絡
3. 異常状況の詳細記録
4. バックアップ環境への切り替え検討

## 📞 サポート連絡先

### 開発チーム
- **Slack**: #dev-team
- **緊急連絡**: [emergency-contact]

### インフラチーム  
- **Slack**: #infrastructure
- **Vercel緊急**: [vercel-support]

### QAチーム内
- **Slack**: #qa-team
- **エスカレーション**: [qa-lead]

## 📚 参考資料

### 必読ドキュメント
- [🎭 リハーサル実行シナリオ](./rehearsal-scenarios.md) - 本番前2段階リハーサル手順
- [🚀 本番UAT実行ガイド](./uat_execution.md) - 本番環境での公式実行手順
- [UAT最終版手順書](./uat_final.md)
- [クリティカルテストチェックリスト](./checklists/critical.md)
- [GitHub Actions実行ガイド](./runner.md)

### サンプル資料
- [成功レポートサンプル](./examples/success-report.md)
- [失敗レポートサンプル](./examples/failure-report.md)  
- [PR自動コメントサンプル](./examples/pr-comment.md)

### 外部ツール
- [Stripe テストカード](https://stripe.com/docs/testing#cards)
- [Resend API ドキュメント](https://resend.com/docs)
- [Next.js Performance](https://nextjs.org/docs/advanced-features/measuring-performance)

---

> 💡 **重要**: このガイドは本番環境での安全なテスト実行を目的としています。不明点がある場合は、必ず開発チームに確認してから実行してください。

> 🔒 **セキュリティ注意**: テスト結果には機微情報が含まれる可能性があります。レポートの取り扱いには十分注意し、不要になったテストデータは適切に削除してください。