# 🚀 本番UAT実行ガイド

本番環境 https://aiohub.jp でのユーザー受け入れテスト（UAT）公式実行手順書です。

## 🚨 【最重要】本番実行前の必読事項

```
⚠️ 本番環境でのテスト実行には重大な責任が伴います

🔴 データ保護: 本番顧客データの変更・削除は絶対禁止
💰 金銭管理: 実際の決済を伴う場合は小額（100円以下）に限定
📧 通信制限: テスト専用メールアドレスのみ使用
🗂️ データ管理: テスト用データは24時間以内に削除
🔐 セキュリティ: 認証情報の記録・共有は厳格に管理

💡 疑問・不安がある場合は実行前に必ず開発チームに確認
```

## 📋 実行可能条件

### ✅ 必須条件

- [ ] **リハーサル2回完了**: 第1回・第2回リハーサルが問題なく完了
- [ ] **開発チーム承認**: UAT実行に関する最終承認取得済み
- [ ] **環境確認完了**: 本番環境の安定性確認済み
- [ ] **バックアップ確認**: 本番データベースの最新バックアップ確認済み
- [ ] **緊急連絡体制**: 開発チーム・インフラチームとの連絡体制確立済み

### 📅 実行タイミング

- **推奨時間帯**: 平日 10:00-18:00（サポート体制が整った時間）
- **避けるべき時間**: 深夜・早朝・土日祝日・システムメンテナンス中
- **所要時間**: 最短40分（クリティカルのみ）〜最長265分（全テスト）

## 🎯 本番UAT実行フロー

### Phase 0: 実行開始宣言（5分）

#### 🔔 チーム通知
```
件名: 【本番UAT開始】AIO Hub UAT実行開始通知

本番環境でのUAT実行を開始します。

実行者: ________________
開始時刻: ____年____月____日 ____時____分
想定終了時刻: ____時____分
実行内容: □事前チェック □クリティカル □重要 □推奨

緊急時連絡先: 
- 技術: ________________
- QA: __________________
- PM: __________________

問題発生時は即座に連絡をお願いします。
```

#### 📊 実行環境最終確認
```bash
# 本番環境疎通確認
curl -I https://aiohub.jp
# 期待値: HTTP/2 200

# 実行環境確認
pwd
git branch --show-current
git log --oneline -3
```

### Phase 1: 事前チェック（5分）

#### ⚡ GitHub Actions実行
1. **GitHub > Actions > "UAT Preflight Checks"**
2. **"Run workflow" > Branch: main > 実行**
3. **結果確認**:
   - [ ] 環境変数チェック: ✅ PASS
   - [ ] DNS/SSL検証: ✅ PASS  
   - [ ] APIエンドポイント確認: ✅ PASS

**❌ 1つでも失敗した場合 → UAT中止・開発チーム連絡**

#### 💻 ローカル確認（オプション）
```bash
npm run uat:preflight
```

### Phase 2: クリティカルテスト（40分）🔴 必須

> 🎯 **判定基準**: 4項目すべて成功で「本番リリース可能」、1項目でも失敗で「リリース延期」

#### 1️⃣ 基本認証フロー（10分）

**テスト用アカウント**:
- メール: `uat-production@luxucare.jp`
- パスワード: 一時的なテスト用パスワード

**実行手順**:
- [ ] **新規登録**: テスト用メールアドレスで新規登録
- [ ] **メール認証**: メール受信・認証リンククリック
- [ ] **ログイン**: 登録したアカウントでログイン成功
- [ ] **ダッシュボード**: 管理画面正常表示
- [ ] **ログアウト**: 正常ログアウト確認

**記録**:
```
開始時刻: ____時____分
終了時刻: ____時____分
結果: ✅ PASS / ❌ FAIL
エラー詳細: ________________
スクリーンショット: □取得済み
```

#### 2️⃣ 企業作成→公開フロー（15分）

**テスト企業情報**:
- 企業名: "UAT検証株式会社"
- 業種: IT・ソフトウェア
- 従業員数: 1-10名

**実行手順**:
- [ ] **企業情報入力**: 基本情報・詳細情報入力
- [ ] **画像アップロード**: ロゴ・サムネイル画像のアップロード
- [ ] **プレビュー確認**: 入力内容のプレビュー表示確認
- [ ] **下書き保存**: 下書き状態での保存確認
- [ ] **公開実行**: 本番環境での公開実行
- [ ] **公開ページ確認**: 公開されたページの表示・アクセス確認

**記録**:
```
開始時刻: ____時____分
終了時刻: ____時____分
結果: ✅ PASS / ❌ FAIL
作成企業ID: ________________
公開URL: ___________________
エラー詳細: ________________
スクリーンショット: □取得済み
```

#### 3️⃣ 決済→サブスクリプションフロー（10分）

**⚠️ 重要**: 実際の決済を行います。テストカードまたは小額決済（100円以下）を使用

**テスト決済情報**:
- カード番号: `4242 4242 4242 4242`（Stripeテストカード）
- 有効期限: `12/34`
- CVC: `123`
- または小額決済: 100円プラン選択

**実行手順**:
- [ ] **プラン選択**: 最小プランまたはテストプラン選択
- [ ] **決済情報入力**: テストカードまたは小額決済情報入力
- [ ] **決済処理**: 決済処理完了確認
- [ ] **サブスクリプション確認**: `subscription_status = 'active'` 確認
- [ ] **課金確認**: Stripeダッシュボードで決済履歴確認
- [ ] **機能アクセス**: 有料機能へのアクセス可能確認

**記録**:
```
開始時刻: ____時____分
終了時刻: ____時____分
結果: ✅ PASS / ❌ FAIL
決済方法: □テストカード □小額決済
決済金額: ____円
Stripe Transaction ID: ________________
Subscription ID: ______________________
エラー詳細: ________________
スクリーンショット: □取得済み
```

#### 4️⃣ セキュリティ基本確認（5分）

**実行手順**:
- [ ] **認証セキュリティ**: 未認証ページへの不正アクセス防止確認
- [ ] **CSRF保護**: フォーム送信時のCSRF保護確認
- [ ] **XSS対策**: 入力フィールドでのスクリプト実行防止確認
- [ ] **権限チェック**: 他ユーザーのデータアクセス制限確認
- [ ] **セッション管理**: ログアウト後のセッション無効化確認

**記録**:
```
開始時刻: ____時____分
終了時刻: ____時____分
結果: ✅ PASS / ❌ FAIL
セキュリティ問題: ________________
緊急度: □低 □中 □高 □緊急
エラー詳細: ________________
```

#### 🎯 クリティカルテスト総合判定

```
□ 基本認証フロー: PASS / FAIL
□ 企業作成→公開: PASS / FAIL  
□ 決済→サブスクリプション: PASS / FAIL
□ セキュリティ基本確認: PASS / FAIL

成功項目数: ____/4
判定: 
□ 🟢 本番リリース可能（4/4成功）
□ 🔴 リリース延期（3/4以下）
□ 🚨 緊急対応必要（セキュリティ問題発見）
```

### Phase 3: 重要テスト（110分）🟡 推奨

> ⚠️ **実行条件**: クリティカルテスト 4/4 成功時のみ実行

#### 1️⃣ 全CRUD操作（45分）

**企業管理CRUD**:
- [ ] 企業情報作成（Create）
- [ ] 企業情報詳細表示（Read）
- [ ] 企業情報更新（Update）
- [ ] 企業情報削除（Delete）

**記事管理CRUD**:
- [ ] 記事作成・下書き（Create）
- [ ] 記事表示・検索（Read）
- [ ] 記事編集・更新（Update）
- [ ] 記事削除・アーカイブ（Delete）

**ユーザー管理CRUD**:
- [ ] ユーザー招待・作成（Create）
- [ ] ユーザー一覧・詳細（Read）
- [ ] ユーザー権限変更（Update）
- [ ] ユーザー削除・無効化（Delete）

#### 2️⃣ 権限別アクセス制御（30分）

**Admin権限テスト**:
- [ ] 全機能アクセス可能
- [ ] ユーザー管理機能アクセス
- [ ] システム設定変更可能

**Editor権限テスト**:
- [ ] 記事編集機能アクセス
- [ ] 企業情報編集機能アクセス
- [ ] ユーザー管理機能制限

**Viewer権限テスト**:
- [ ] 閲覧機能のみアクセス
- [ ] 編集機能アクセス制限
- [ ] 管理機能アクセス制限

#### 3️⃣ メール通知全パターン（20分）

**通知パターンテスト**:
- [ ] 新規登録通知
- [ ] メール認証通知
- [ ] パスワードリセット通知
- [ ] 企業公開通知
- [ ] サブスクリプション変更通知
- [ ] ユーザー招待通知

#### 4️⃣ データ整合性確認（15分）

**整合性チェック**:
- [ ] リレーションデータ一致確認
- [ ] 削除連鎖動作確認
- [ ] インデックス整合性確認
- [ ] バックアップデータ一致確認

### Phase 4: 推奨テスト（115分）🟢 オプション

> ⚠️ **実行条件**: 重要テスト完了かつ時間的余裕がある場合のみ

#### 1️⃣ パフォーマンス監視（30分）
#### 2️⃣ SEO構造化データ検証（20分）
#### 3️⃣ エラーハンドリング確認（25分）
#### 4️⃣ 運用監視設定（40分）

### Phase 5: レポート生成・完了（15分）

#### 📊 自動レポート生成
```bash
npm run uat:report
```

#### 📝 完了通知
```
件名: 【本番UAT完了】AIO Hub UAT実行結果報告

本番環境でのUAT実行が完了しました。

実行者: ________________
開始時刻: ____年____月____日 ____時____分
終了時刻: ____年____月____日 ____時____分
実行時間: ____分

■ 実行結果
□ 事前チェック: PASS / FAIL
□ クリティカルテスト: PASS (4/4) / FAIL (__/4)
□ 重要テスト: PASS (__/4) / FAIL (__/4) / 未実施
□ 推奨テスト: PASS (__/4) / FAIL (__/4) / 未実施

■ 最終判定
□ 🟢 本番リリース可能
□ 🔴 リリース延期
□ 🚨 緊急対応必要

■ レポート
自動生成レポート: docs/uat/logs/YYYYMMDD/uat-report.md
実行ログ: 添付ファイル参照

■ 次のアクション
1. ________________________
2. ________________________
3. ________________________
```

## 🔒 本番UAT実行時の絶対禁止事項

### ❌ データ関連
- 既存顧客データの変更・削除
- 本番データベースへの直接クエリ実行
- 個人情報・機密情報の画面キャプチャ
- テストデータの24時間超過放置

### ❌ 決済関連
- 100円を超える実決済実行
- 他人のクレジットカード情報使用
- 決済テストの繰り返し実行（5回以上）
- 返金処理の不実行

### ❌ 通信関連
- 実在顧客へのテストメール送信
- 本番通知システムの大量送信
- 外部APIの過度な呼び出し
- SNS等への誤投稿

### ❌ セキュリティ関連
- 認証情報のプレーンテキスト記録
- セキュリティ設定の変更
- 本番環境設定の変更
- 脆弱性の意図的悪用

## 🚨 緊急時対応手順

### 🔴 緊急停止条件
- データ破損・消失の発生
- セキュリティ問題の発見
- 決済エラー・誤課金の発生
- システム全体の不安定化

### 📞 緊急連絡手順
1. **即座にUAT中止**
2. **開発チーム緊急連絡**: [緊急連絡先]
3. **インフラチーム連絡**: [インフラ緊急連絡先]
4. **状況詳細記録**: エラー内容・発生時刻・実行内容
5. **影響範囲調査**: 顧客データ・決済・システム影響の確認

### 🛠️ 復旧支援
- ログファイル・スクリーンショット提供
- 実行手順・操作内容の詳細共有
- 問題発生時刻・環境状況の報告
- 復旧作業への協力・検証支援

## 📋 本番UAT記録テンプレート

### 基本情報
```
実施日: ____年____月____日（____曜日）
実施時間: ____時____分 〜 ____時____分（____分間）
実行者: ________________
承認者: ________________
実行環境: 本番（https://aiohub.jp）
Git Commit: ________________
```

### 事前確認
```
□ リハーサル2回完了
□ 開発チーム承認取得
□ バックアップ確認完了
□ 緊急連絡体制確立
□ テスト用アカウント準備完了
□ 実行時間帯確認（平日10-18時）
```

### Phase1: 事前チェック
```
開始時刻: ____時____分
GitHub Actions実行: □成功 □失敗
□ 環境変数チェック: PASS / FAIL
□ DNS/SSL検証: PASS / FAIL
□ APIエンドポイント: PASS / FAIL
問題詳細: ________________
```

### Phase2: クリティカルテスト（必須）
```
開始時刻: ____時____分
終了時刻: ____時____分

1. 基本認証フロー:
   □ PASS □ FAIL
   テストアカウント: ________________
   エラー詳細: ________________
   
2. 企業作成→公開:
   □ PASS □ FAIL
   作成企業ID: ________________
   公開URL: ________________
   エラー詳細: ________________
   
3. 決済→サブスクリプション:
   □ PASS □ FAIL
   決済方法: □テストカード □小額決済
   決済金額: ____円
   Transaction ID: ________________
   エラー詳細: ________________
   
4. セキュリティ基本確認:
   □ PASS □ FAIL
   セキュリティ問題: ________________
   緊急度: □低 □中 □高 □緊急
```

### Phase3: 重要テスト（推奨）
```
実行: □する □しない
理由: ________________

開始時刻: ____時____分
終了時刻: ____時____分

□ 全CRUD操作 (__分): PASS / FAIL / 未実施
□ 権限別アクセス制御 (__分): PASS / FAIL / 未実施  
□ メール通知全パターン (__分): PASS / FAIL / 未実施
□ データ整合性確認 (__分): PASS / FAIL / 未実施
```

### Phase4: 推奨テスト（オプション）
```
実行: □する □しない
理由: ________________

□ パフォーマンス監視: PASS / FAIL / 未実施
□ SEO構造化データ検証: PASS / FAIL / 未実施
□ エラーハンドリング確認: PASS / FAIL / 未実施
□ 運用監視設定: PASS / FAIL / 未実施
```

### 最終判定
```
■ 総合結果
事前チェック: ____/3 成功
クリティカルテスト: ____/4 成功
重要テスト: ____/4 成功 / 未実施
推奨テスト: ____/4 成功 / 未実施

■ リリース判定
□ 🟢 本番リリース可能（クリティカル4/4成功）
□ 🔴 リリース延期（クリティカル失敗あり）
□ 🚨 緊急対応必要（セキュリティ・決済問題）

判定理由: ________________

■ 発見された問題
重要度【高】: ________________
重要度【中】: ________________
重要度【低】: ________________

■ 次のアクション
1. ________________（期限: ____日）
2. ________________（期限: ____日）
3. ________________（期限: ____日）

■ リリース予定
□ 即座にリリース可能
□ 修正後リリース（予定: ____日）
□ 再UAT後リリース（予定: ____日）
□ リリース延期・検討継続
```

### データクリーンアップ
```
□ テスト用企業データ削除完了
□ テスト用ユーザーアカウント削除完了
□ テスト決済データ確認・処理完了
□ テストメールアドレス無効化完了
□ スクリーンショット・ログファイル適切保管
□ 機密情報マスキング処理完了
```

---

## 🔗 関連ドキュメント

- [📋 UAT README](./README.md) - 全体概要とナビゲーション
- [🎭 リハーサル実行シナリオ](./rehearsal-scenarios.md) - 本番前準備手順
- [🎯 QA担当者向けガイド](./qa-guide.md) - トラブルシューティング
- [📊 レポート・PRコメントサンプル](./examples/) - 結果サンプル
- [🚀 実行ガイド](./runner.md) - コピペ実行マニュアル

---

> 🚀 **本番UAT成功の鍵**: 「準備8割、実行2割」  
> リハーサルで十分に準備し、本番では慎重かつ迅速に実行することで、安全で確実なリリース判定を行うことができます。

> 🔒 **データ保護の徹底**: 本番環境での作業は常に「顧客データを守る」意識を最優先に、責任を持って実行してください。