# 🟡 重要テスト チェックリスト（1週間以内）

**所要時間**: 約110分  
**実行タイミング**: 本番リリース後1週間以内  
**実行者**: ________________  
**実行日時**: ________________

---

## 📋 テスト1: 全CRUD操作確認（45分）

### サービス管理テスト（15分）
- [ ] サービス作成: 名前・概要・特徴・価格入力→保存成功
- [ ] サービス読取: 作成したサービスが詳細ページで正確表示
- [ ] サービス編集: 内容変更→保存→反映確認
- [ ] サービス削除: 削除実行→一覧から除外→DB確認
- [ ] 公開ページ反映: サービス追加/編集が公開ページにリアルタイム反映

### FAQ管理テスト（15分）
- [ ] FAQ作成: 質問・回答入力→保存成功
- [ ] FAQ編集: 内容変更→保存→反映確認  
- [ ] FAQ削除: 削除実行→一覧から除外
- [ ] FAQ並び替え: 順序変更機能動作確認
- [ ] 公開ページ反映: FAQ更新が公開ページに反映

### 導入事例管理テスト（15分）
- [ ] 事例作成: タイトル・業種・課題・解決策・成果・メトリクス入力→保存
- [ ] 事例編集: 内容変更→保存→反映確認
- [ ] 事例削除: 削除実行→関連データも完全削除
- [ ] メトリクス機能: 数値指標の追加・編集・削除
- [ ] 公開ページ反映: 事例更新が適切に表示

---

## 📋 テスト2: 権限別アクセス制御（30分）

### テストユーザー準備
```sql
-- Supabase Auth で事前作成必要
admin@luxucare-test.jp / TestAdmin123!
editor@luxucare-test.jp / TestEditor123!
viewer@luxucare-test.jp / TestViewer123!

-- 権限設定（実際のUUIDに置換）
INSERT INTO public.users (id, email, role, name) VALUES
('[UUID1]', 'admin@luxucare-test.jp', 'admin', '管理者テスト'),
('[UUID2]', 'editor@luxucare-test.jp', 'editor', '編集者テスト'),
('[UUID3]', 'viewer@luxucare-test.jp', 'viewer', '閲覧者テスト');
```

### 権限マトリックス確認
| 操作 | Admin期待 | Editor期待 | Viewer期待 | 確認結果 |
|------|----------|-----------|-----------|----------|
| 企業作成 | ✅ | ✅ | ❌ | [ ][ ][ ] |
| 企業編集 | ✅ | ✅ | ❌ | [ ][ ][ ] |
| 企業削除 | ✅ | ❌ | ❌ | [ ][ ][ ] |
| 公開/非公開 | ✅ | ✅ | ❌ | [ ][ ][ ] |
| サービス管理 | ✅ | ✅ | ❌ | [ ][ ][ ] |
| ユーザー管理 | ✅ | ❌ | ❌ | [ ][ ][ ] |
| システム設定 | ✅ | ❌ | ❌ | [ ][ ][ ] |

### UI表示確認
- [ ] Admin: 全機能のボタン・メニューが表示
- [ ] Editor: 削除・ユーザー管理・システム設定のボタン非表示
- [ ] Viewer: 閲覧のみ、編集系ボタン全て非表示
- [ ] エラーハンドリング: 権限不足時に適切なエラーメッセージ

---

## 📋 テスト3: メール通知全パターン（20分）

### ウェルカムメール確認
- [ ] 送信タイミング: 新規登録完了後即座に送信
- [ ] 件名: "AIO Hubへようこそ" または適切な件名
- [ ] 送信者: noreply@aiohub.jp
- [ ] 本文内容: ユーザー名表示、サービス概要、ダッシュボードリンク
- [ ] HTMLメール: 適切なデザインとレイアウト
- [ ] テキストメール: HTMLが表示できない環境用の代替版

### 決済完了通知確認
- [ ] 送信タイミング: 決済成功後30秒以内
- [ ] 件名: "サブスクリプション開始のお知らせ"
- [ ] 本文内容: プラン名、金額、次回請求日、請求書リンク
- [ ] Stripe連携: 正しい決済情報が反映

### 決済失敗通知確認
```bash
# テスト用失敗カード: 4000 0000 0000 0002
```
- [ ] 送信タイミング: 決済失敗後30秒以内
- [ ] 件名: "決済処理に失敗しました【重要】"
- [ ] 本文内容: 失敗理由、再試行リンク、サポート連絡先
- [ ] 緊急度表示: 重要度の高いデザイン・文言

### Resend Dashboard確認
- [ ] 配信ログ: 全メールの送信ログ確認
- [ ] 配信成功率: 98%以上
- [ ] エラー率: 2%以下  
- [ ] バウンス・苦情: 適切な管理

---

## 📋 テスト4: データ整合性確認（15分）

### 関連データ削除テスト
```sql
-- 1. テスト企業にサービス・FAQ・事例を作成
-- 2. 企業削除実行
-- 3. 以下SQLで関連データ完全削除確認

SELECT 
  (SELECT COUNT(*) FROM services WHERE organization_id = '[削除企業ID]') as services_count,
  (SELECT COUNT(*) FROM faqs WHERE organization_id = '[削除企業ID]') as faqs_count,
  (SELECT COUNT(*) FROM case_studies WHERE organization_id = '[削除企業ID]') as case_studies_count;

-- 期待結果: 全て0（完全削除）
```

### カスケード削除確認
- [ ] 企業削除時: 関連サービス・FAQ・事例も自動削除
- [ ] サービス削除時: 関連するメトリクス・画像等も削除
- [ ] ユーザー削除時: 所有企業の適切な処理（移譲または削除）
- [ ] 孤立データなし: 参照整合性が保たれている

### 所有権移譲テスト
```sql
-- ユーザー削除時の企業所有権確認
SELECT o.name, u.email as current_owner, COUNT(om.user_id) as member_count
FROM organizations o
JOIN users u ON o.user_id = u.id
LEFT JOIN organization_members om ON o.id = om.organization_id
WHERE o.id = '[テスト企業ID]'
GROUP BY o.id, o.name, u.email;
```

- [ ] 共同管理者存在時: 所有権が適切に移譲
- [ ] 単独所有者削除時: 企業も削除または管理者なし状態
- [ ] 権限継承: 新所有者が適切な権限を取得

---

## ✅ 重要テスト完了判定

### 必須項目チェック
- [ ] 🟡 全CRUD操作: 45分のテスト完了
- [ ] 🟡 権限別アクセス制御: 30分のテスト完了
- [ ] 🟡 メール通知全パターン: 20分のテスト完了
- [ ] 🟡 データ整合性: 15分のテスト完了

### 成功基準
- CRUD操作: 全機能エラーなく動作
- 権限制御: マトリックス通りの制御
- メール通知: 全パターン正常送信
- データ整合性: 関連データ適切処理

### 最終判定
**[ ] ✅ 全テスト成功 → 推奨テストに進行可能**  
**[ ] ⚠️ 一部問題 → 改善計画立案、運用開始は可能**  
**[ ] ❌ 重大な問題 → 修正後再テスト必要**

---

## 🚨 問題発見時の対応

### 軽微な問題（運用継続可能）
- UI表示の軽微な不具合
- メール配信の軽微な遅延
- 権限制御の非クリティカルな問題

**対応**: 改善チケット作成、次回リリースで修正

### 重要な問題（早急な修正必要）
- CRUD操作でのデータ損失
- 権限制御の重大な欠陥
- メール送信の完全失敗

**対応**: 緊急修正パッチ適用、修正後再テスト

### 重大な問題（運用停止検討）
- データ整合性の破綻
- セキュリティホールの発見
- 大規模なデータ破損

**対応**: 即座に運用停止検討、根本修正まで機能制限

---

**🎯 重要テストの結果に基づいて、推奨テストの実施タイミングと内容を調整してください。**