================================================================================
⚠️ ARCHIVED - 参照禁止

本文書は旧アーキテクチャ（セルフサーブ＋代理店併存モデル）に基づく。
現行正本: docs/core-architecture.md を参照のこと。

アーカイブ日: 2024-12-25
================================================================================

================================================================================
AIO Hub 要件定義書 改訂提案書
================================================================================
作成日: 2024-12-24
目的: 現行の要件定義書群を、実際の実装状況と現在のビジョンに合わせて改訂する

================================================================================
第1部: 現状分析
================================================================================

【1.1 既存の要件定義書一覧】

以下のMDファイルが要件を定義しているが、内容が古く実装と乖離している：

■ 主要要件書（改訂必須）
  - docs/requirements_business.md      ... ビジネス要件（初期ビジョン）
  - docs/requirements_system.md        ... システム/技術要件
  - docs/requirements_overview.md      ... 全体像・非機能要件
  - docs/requirements_ux.md            ... UX・ナビゲーション要件
  - docs/sprints.md                    ... スプリント計画（完了済み・過去の計画）
  - docs/DESIGN_SYSTEM.md              ... デザインシステム

■ 機能別要件書（統合検討）
  - docs/requirements_ai_visibility_module.md
  - docs/ai-interviewer-implementation.md
  - docs/dashboard-phase3-ui-design.md
  - docs/ai-seo-dashboard-implementation.md
  - docs/supabase対応_要件定義書.md

■ 運用・テスト関連（維持）
  - docs/ENFORCEMENT_OPERATIONS_MANUAL.md
  - docs/ENVIRONMENT_VARIABLES.md
  - docs/production-deployment-checklist.md

================================================================================

【1.2 初期ビジョン vs 現在の実装】

┌─────────────────────────────────────────────────────────────────────────────┐
│ 初期ビジョン（requirements_business.md）                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│ • セルフサーブ＋代理店併存モデル                                            │
│ • 最短60分で企業情報を公開                                                  │
│ • JSON-LD構造化データでAI検索最適化                                         │
│ • 基本CMS: Organizations, Services, FAQ, Case Studies, Posts               │
│ • Stripe課金（単一プラン構想）                                               │
│ • シンプルなロール: org_owner, partner, admin                              │
└─────────────────────────────────────────────────────────────────────────────┘

                              ↓ 大幅に拡張された

┌─────────────────────────────────────────────────────────────────────────────┐
│ 現在の実装                                                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│ 【AI機能群】                                                                 │
│   • AI Visibility（AI可視性分析）                                           │
│   • AI Citations（AI引用追跡）                                              │
│   • AI Bot Logs（AIボットアクセスログ）                                     │
│   • AI Monthly Reports（月次AIレポート生成）                                │
│   • AI Q&A System（AIによる質問回答システム）                               │
│                                                                             │
│ 【インタビュー/ヒアリング機能】                                             │
│   • Hearing Sessions（ヒアリングセッション管理）                            │
│   • Interview System（AIインタビュアー）                                    │
│   • Session History/Transcripts                                             │
│                                                                             │
│ 【コンテンツ管理拡張】                                                       │
│   • Q&A Categories/Entries（Q&Aシステム）                                   │
│   • Sales Materials（営業資料管理）                                         │
│   • Content Units（コンテンツユニット）                                     │
│   • Embeddings/Chunks（検索用ベクトル）                                     │
│                                                                             │
│ 【組織管理拡張】                                                             │
│   • Organization Groups（組織グループ）                                     │
│   • Feature Flags（機能フラグ管理）                                         │
│   • Multi-membership（複数組織所属）                                        │
│                                                                             │
│ 【運用機能】                                                                 │
│   • Enforcement System（ユーザー制裁管理）                                  │
│   • Audit Logs/Activities（監査ログ）                                       │
│   • Metrics/Analytics（詳細分析）                                           │
│   • Management Console（管理コンソール）                                    │
│                                                                             │
│ 【多言語対応】                                                               │
│   • Translations（翻訳管理）                                                │
│   • Locales（ロケール設定）                                                 │
└─────────────────────────────────────────────────────────────────────────────┘

================================================================================

【1.3 データベース構造の進化】

初期設計のテーブル（8テーブル）:
  organizations, services, case_studies, faqs, posts,
  profiles, organization_profiles, subscriptions

現在のテーブル（50+テーブル）:
  ■ コア
    organizations, services, case_studies, faqs, posts, profiles

  ■ AI系（新規）
    ai_answers, ai_bot_logs, ai_chunks, ai_citations,
    ai_content_units, ai_monthly_reports, ai_queries,
    ai_sections, ai_visibility_snapshots

  ■ インタビュー系（新規）
    hearing_requests, hearing_sessions, interview_sessions,
    interview_transcripts, interview_summary

  ■ Q&A系（新規）
    qa_categories, qa_entries, qa_content_logs, qa_view_stats

  ■ 営業資料系（新規）
    sales_materials, sales_material_stats

  ■ 組織拡張（新規）
    organization_groups, org_group_members, org_group_join_requests,
    organization_memberships, feature_flags

  ■ 運用系（新規）
    activities, audit_logs, enforcement_actions, violations,
    system_alerts, translations, locales

================================================================================
第2部: 改訂提案
================================================================================

【2.1 要件定義書の再構成案】

現在の分散した要件書を、以下の構造に統合・再編する：

docs/
├── requirements/
│   ├── 00_overview.md              # プロダクト概要・ビジョン
│   ├── 01_user_segments.md         # ユーザーセグメント定義
│   ├── 02_core_features.md         # コア機能要件
│   ├── 03_ai_features.md           # AI機能要件（NEW）
│   ├── 04_dashboard.md             # ダッシュボード要件（NEW）
│   ├── 05_admin_ops.md             # 管理・運用要件
│   ├── 06_non_functional.md        # 非機能要件
│   └── 07_design_system.md         # デザインシステム
│
├── architecture/
│   ├── database_schema.md          # 現行DBスキーマ解説
│   ├── api_design.md               # API設計方針
│   └── security_model.md           # セキュリティモデル
│
└── operations/
    ├── deployment.md               # デプロイ手順
    ├── monitoring.md               # 監視・アラート
    └── troubleshooting.md          # トラブルシューティング

================================================================================

【2.2 各要件書の改訂内容案】

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
■ 00_overview.md - プロダクト概要
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【現在の記述（requirements_overview.md）】
  - "最短60分で公開完了"
  - "セルフサーブ＋代理店併存モデル"

【改訂案】
  - "AIに正しく理解される企業情報プラットフォーム"
  - 主要価値提案：
    1. AI検索・AI回答での発見性向上
    2. 企業情報の構造化と自動最適化
    3. AI可視性の継続的モニタリング
    4. AIインタビューによる情報収集支援

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
■ 01_user_segments.md - ユーザーセグメント
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【現在の記述（requirements_business.md）】
  - セルフサーブユーザー（企業直接利用）
  - 代理店ユーザー（partner ロール）
  - 管理者（admin）

【改訂案】
  ■ 一般ユーザー（料金プラン別）

    ┌────────────┬──────────────┬─────────────────────────────────┐
    │ プラン      │ 価格（税別/月） │ 想定ユーザー像                   │
    ├────────────┼──────────────┼─────────────────────────────────┤
    │ Starter    │ ¥2,980       │ 小規模事業者、まずAIOHubを試したい人 │
    │ Pro        │ ¥8,000       │ 本格的にAI＋CMS運用したい中小企業   │
    │ Business   │ ¥15,000      │ サービス数・Q&Aが多い法人        │
    │ Enterprise │ 問い合わせ     │ 個別要件・カスタムAIワークフローが必要な企業 │
    └────────────┴──────────────┴─────────────────────────────────┘

    ※ Starterのみ14日間トライアルあり

    - 組織オーナー（owner）/ 編集者（editor）/ 閲覧者（viewer）

  ■ パートナー
    - 代理店パートナー: 顧客企業の代理管理
    - OEMパートナー: ホワイトラベル提供

  ■ 管理者
    - システム管理者（admin）: 全機能アクセス
    - 運用担当者: 監視・対応のみ

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
■ 02_core_features.md - コア機能要件
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【現在の記述（requirements_business.md）】
  - 企業情報CRUD
  - サービス/事例/FAQ/記事管理
  - 公開ページ生成
  - JSON-LD出力

【改訂案】
  ■ 企業情報管理
    - 基本情報（名称、住所、連絡先、代表者等）
    - ブランディング（ロゴ、カラー、メッセージ）
    - 業界・キーワード設定
    - 公開/非公開制御

  ■ コンテンツ管理
    - サービス/商品情報
    - 導入事例（Case Studies）
    - FAQ（よくある質問）
    - ニュース/ブログ記事
    - Q&Aエントリー

  ■ 構造化データ出力
    - JSON-LD自動生成（Organization/Service/FAQ/Article）
    - OGP自動生成
    - サイトマップ自動更新

  ■ プラン別コンテンツ管理制限

    ┌─────────────────────────┬──────────┬────────┬──────────┬────────────┐
    │ 機能                     │ Starter  │ Pro    │ Business │ Enterprise │
    ├─────────────────────────┼──────────┼────────┼──────────┼────────────┤
    │ サービス登録数            │ 5件      │ 20件   │ 無制限   │ 無制限     │
    │ Q&A登録数               │ 10件     │ 50件   │ 無制限   │ 無制限     │
    │ 導入事例                 │ なし     │ 10件   │ 無制限   │ 無制限     │
    │ カテゴリー・タグ          │ 簡易     │ ○     │ ○       │ カスタム   │
    │ Hub内公開               │ ○       │ ○     │ ○       │ カスタム   │
    │ JSON-LD構造化データ      │ ○       │ ○     │ ○       │ ○        │
    │ 複数ブランド管理          │ ×       │ ×     │ ○       │ ○        │
    └─────────────────────────┴──────────┴────────┴──────────┴────────────┘

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
■ 03_ai_features.md - AI機能要件（新規追加）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【新規作成】
  ■ AI可視性分析（AI Visibility）
    - AIボットのアクセスログ追跡
    - AI引用（Citations）の検出・記録
    - 可視性スコアの算出
    - 月次レポート自動生成

  ■ AIインタビュアー
    - 対話型の情報収集
    - セッション管理・履歴保存
    - 回答の要約・構造化

  ■ 企業専用AIチャットボット
    - FAQ/コンテンツベースの回答
    - カスタム知識ベース
    - 回答品質の継続改善

  ■ AI検索最適化
    - コンテンツのベクトル化
    - セマンティック検索対応
    - 多言語対応（翻訳機能）

  ■ プラン別AI機能制限

    ┌────────────────────────┬────────────────┬──────────┬────────────┬────────────┐
    │ 機能                    │ Starter        │ Pro      │ Business   │ Enterprise │
    ├────────────────────────┼────────────────┼──────────┼────────────┼────────────┤
    │ AIインタビュアー         │ 5回/月         │ 3,000回/月│ 10,000回/月│ カスタム    │
    │ AIコンテンツ生成         │ 5回/月         │ 3,000回/月│ 10,000回/月│ カスタム    │
    │ AI引用ログ記録          │ 5回/月         │ 3,000回/月│ 10,000回/月│ カスタム    │
    │ インタビュー分析         │ ×             │ ×        │ 10,000回/月│ カスタム    │
    │ 月次AIレポート          │ ライト版       │ 詳細版    │ 高度版     │ カスタム    │
    └────────────────────────┴────────────────┴──────────┴────────────┴────────────┘

    ※ Starterは「AI体験版」としての位置付け。本格運用にはProへのアップグレードが必須
    ※ Pro/Businessの回数上限は破綻防止の安全策として設定

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
■ 04_dashboard.md - ダッシュボード要件（新規追加）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【新規作成】
  ■ ホームダッシュボード
    - 組織概要・公開状況
    - パフォーマンスメトリクス
    - AI可視性サマリー
    - クイックアクション

  ■ コンテンツ管理
    - FAQ管理（/dashboard/faqs）
    - サービス管理（/dashboard/services）
    - 事例管理（/dashboard/case-studies）
    - 記事管理（/dashboard/posts）

  ■ AI機能
    - AIチャットボット（/dashboard/org-ai-chat）
    - AIインタビュー（/dashboard/interview）
    - AI引用分析（/dashboard/ai-citations）
    - 月次レポート（/dashboard/reports）

  ■ 分析・統計
    - Q&A統計（/dashboard/qna-stats）
    - 営業資料統計（/dashboard/materials）
    - パフォーマンス分析

  ■ 設定
    - 組織設定（/dashboard/settings）
    - 課金管理（/dashboard/billing）
    - 埋め込みウィジェット（/dashboard/embed）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
■ 05_admin_ops.md - 管理・運用要件
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【現在の記述】
  - /ops/verify, /ops/probe のみ

【改訂案】
  ■ 管理コンソール（/management-console）
    - ユーザー管理
    - ヒアリング管理
    - 連絡先管理
    - レポート閲覧
    - セキュリティ設定
    - 埋め込みダッシュボード

  ■ 運用ツール（/ops）
    - システム診断
    - ヘルスチェック
    - パフォーマンス監視

  ■ ユーザー制裁（Enforcement）
    - 警告（warn）
    - 一時停止（suspend）
    - 凍結（freeze）
    - 削除（delete）
    - 復権（reinstate）

  ■ サポートポリシー（全プラン共通）

    【基本方針】
    - 原則セルフサーブ運用
    - オンラインヘルプ・ガイド・チュートリアル・AIレポートで自己解決
    - メール窓口は障害報告・課金トラブル等の最低限のみ
    - 返信期限・SLAは明示しない（ベストエフォート）

    【提供しないもの】
    - 電話サポート
    - チャットサポート
    - 優先対応枠
    - 専任担当・カスタマーサクセス

    【Enterpriseの扱い】
    - 専任サポートは標準機能として提供しない
    - 必要な場合は個別の開発・コンサル契約（別見積もり）として扱う

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
■ 07_design_system.md - デザインシステム
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【現在の問題点】
  - 公開ページとダッシュボードでデザイン適用が不統一
  - ダッシュボードはTailwind直書きが多い
  - デザイントークンの使用が徹底されていない

【改訂案】
  ■ デザイントークン
    - カラー: --aio-primary, --aio-surface, --aio-muted 等
    - タイポグラフィ: フォントサイズ、行間
    - スペーシング: 8pt グリッドシステム
    - シャドウ/ボーダー: 統一されたエレベーション

  ■ コンポーネント体系
    - 公開ページ用: AioSection, HIGButton, HIGCard
    - ダッシュボード用: DashboardSection, DashboardCard（要作成）
    - 共通: glass-card, spring-bounce等

  ■ レイアウトルール
    - 公開ページ: AioSection + tone（white/muted/primary）
    - ダッシュボード: サイドバー固定 + コンテンツエリア
    - 共通: max-w-7xl, px-6, lg:px-8

================================================================================
第3部: 移行計画
================================================================================

【3.1 フェーズ分け】

Phase 1: 要件書の再構成（1週間）
  - 新しいディレクトリ構造の作成
  - 既存内容の整理・統合
  - 古い記述の削除・更新

Phase 2: DB/APIドキュメント整備（1週間）
  - 現行スキーマの完全ドキュメント化
  - API一覧とエンドポイント説明
  - セキュリティモデルの明文化

Phase 3: デザインシステム統一（2週間）
  - ダッシュボード用コンポーネント作成
  - 既存ページのリファクタリング
  - デザイントークン使用の徹底

Phase 4: 運用ドキュメント整備（1週間）
  - デプロイ手順の最新化
  - 監視・アラート設定
  - トラブルシューティングガイド

================================================================================

【3.2 削除対象のファイル】

以下は統合後に削除またはアーカイブ：

  docs/requirements_business.md      → 00_overview.md に統合
  docs/requirements_overview.md      → 00_overview.md + 06_non_functional.md に分割
  docs/requirements_system.md        → architecture/ に移動
  docs/requirements_ux.md            → 04_dashboard.md に統合
  docs/sprints.md                    → アーカイブ（過去の計画として保存）
  docs/requirements.md               → 削除（空または重複）
  docs/requirements_mvp.md           → 削除（過去のMVP計画）

================================================================================

【3.3 新規作成が必要なファイル】

  docs/requirements/03_ai_features.md        # AI機能の要件定義
  docs/requirements/04_dashboard.md          # ダッシュボードの要件定義
  docs/architecture/database_schema.md       # 現行DBスキーマ解説
  docs/architecture/api_design.md            # API設計方針
  src/components/dashboard/DashboardSection.tsx  # ダッシュボード用セクション
  src/components/dashboard/DashboardCard.tsx     # ダッシュボード用カード

================================================================================
第4部: 実装への影響
================================================================================

【4.1 コード変更不要な項目】

以下はドキュメント更新のみで対応：
  - 機能説明の現実反映
  - ユーザーセグメントの再定義
  - 非機能要件の更新

【4.2 コード変更が必要な項目】

■ デザインシステム統一
  - ダッシュボードページでのTailwind直書きをトークン化
  - HIGButton等の統一使用
  - AioSection相当のダッシュボード用コンポーネント作成

■ レイアウト整理
  - ダッシュボードのサイドバー常時表示（修正済み）
  - 公開ヘッダー/フッターのダッシュボード非表示（修正済み）

■ API整理
  - エンドポイントの命名規則統一
  - レスポンス形式の統一

================================================================================
第5部: 推奨アクション
================================================================================

【即座に実行すべき項目】

1. CLAUDE.mdの更新
   - 新しい要件書構造への参照追加
   - デザインシステムルールの明確化

2. 要件書ディレクトリの作成
   ```
   mkdir -p docs/requirements docs/architecture docs/operations
   ```

3. 概要要件書の作成（00_overview.md）
   - 現在のプロダクトビジョンを反映
   - AIファーストのポジショニング

【中期的に実行すべき項目】

1. ダッシュボード用デザインコンポーネントの作成
2. 既存ダッシュボードページのリファクタリング
3. API設計ドキュメントの整備

【長期的に検討すべき項目】

1. i18n対応の本格実装
2. モバイルアプリ対応
3. API v2の設計

================================================================================
付録A: 正式料金プラン定義（2024-12-24時点）
================================================================================

【重要】この仕様書は料金プランの正式な定義である。
UI・料金ページ・プラン判定ロジックはこの仕様を参照して実装・変更すること。
数値・内容を変更する場合は、この文書を更新することを必須ルールとする。

┌────────────┬──────────────┬─────────────────────────────────────────┐
│ プラン      │ 価格（税別/月） │ 想定ユーザー像                            │
├────────────┼──────────────┼─────────────────────────────────────────┤
│ Starter    │ ¥2,980       │ 小規模事業者、まずAIOHubを試したい人          │
│ Pro        │ ¥8,000       │ 本格的にAI＋CMS運用したい中小企業            │
│ Business   │ ¥15,000      │ サービス数・Q&Aが多い法人、複数ブランド運用    │
│ Enterprise │ 問い合わせ     │ 個別要件・カスタムAIワークフローが必要な企業   │
└────────────┴──────────────┴─────────────────────────────────────────┘

※ Starterのみ14日トライアルあり

【AI実行回数の安全運用ポリシー】

■ プラン別AI使用回数上限（月/組織）

  ┌────────────────────┬─────────┬──────────┬────────────┬────────────┐
  │ 機能                │ Starter │ Pro      │ Business   │ Enterprise │
  ├────────────────────┼─────────┼──────────┼────────────┼────────────┤
  │ AIインタビュアー     │ 5回     │ 3,000回  │ 10,000回   │ カスタム    │
  │ AIコンテンツ生成     │ 5回     │ 3,000回  │ 10,000回   │ カスタム    │
  │ AI引用ログ記録      │ 5回     │ 3,000回  │ 10,000回   │ カスタム    │
  │ インタビュー分析     │ ×      │ ×       │ 10,000回   │ カスタム    │
  └────────────────────┴─────────┴──────────┴────────────┴────────────┘

■ Starterの上限（厳格に実装）
  → 上限超過時はUIでボタン無効化＋API側でもブロック
  → 「無制限」への緩和は禁止事項

■ Pro/Businessの上限ポリシー
  - 破綻防止の安全策として明確な上限を設定
  - 上限変更時は、まずこの仕様書を更新→その後Supabase/アプリ側を揃える

================================================================================
付録B: 現行DBテーブル一覧
================================================================================

■ コアエンティティ
  organizations, services, case_studies, faqs, posts

■ ユーザー・権限
  profiles, app_users, organization_memberships, organization_profiles

■ AI機能
  ai_answers, ai_bot_logs, ai_chunks, ai_citations, ai_content_units,
  ai_monthly_reports, ai_queries, ai_sections, ai_visibility_snapshots

■ インタビュー
  hearing_requests, hearing_sessions, interview_sessions,
  interview_transcripts, interview_summary

■ Q&A
  qa_categories, qa_entries, qa_content_logs, qa_question_templates,
  qa_view_stats

■ 営業資料
  sales_materials, sales_material_stats

■ 組織グループ
  org_groups, org_group_members, org_group_join_requests

■ 課金
  stripe_customers, subscriptions, billing_links

■ 運用
  activities, audit_logs, enforcement_actions, violations,
  system_alerts, cron_job_logs

■ 翻訳・ロケール
  translations, locales, locale_config

■ その他
  redirects, api_keys, embed_configs, feature_flags,
  news, partners, questions, reviews, site_settings

================================================================================
文書終了
================================================================================
