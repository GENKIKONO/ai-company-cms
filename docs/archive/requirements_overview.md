> ⚠️ **ARCHIVED - 参照禁止**
>
> 本文書は旧アーキテクチャ（セルフサーブ＋代理店併存モデル）に基づく。
> **現行正本: `docs/core-architecture.md` を参照のこと。**
>
> アーカイブ日: 2024-12-25

---

# 要件定義書：全体像・非機能要件

## システム概要

**AIO Hub AI企業CMS** は、企業の構造化データ（JSON-LD）とSEO最適化された公開ページを、最短60分で生成・運用できるSaaSプラットフォームです。

### 運用モデル

**セルフサーブ＋代理店併存モデル**を採用し、2つの導線を同時に提供します：

1. **セルフサーブモード（1ユーザー=1組織）**
   - 企業が直接登録・利用
   - 承認なしで即座に公開可能
   - ¥5,000/月のサブスクリプション

2. **代理店モード（partner ロール）**
   - 印刷会社・制作会社が顧客企業を代理管理
   - 1つのpartnerアカウントで複数企業を管理
   - 既存機能を無効化せず維持

## 非機能要件

### 性能要件

| 項目 | 要件 | 測定方法 |
|------|------|----------|
| ページ応答時間 | ≤ 2秒 (P95) | Core Web Vitals |
| 公開ページ生成 | ≤ 5秒 | API エンドポイント計測 |
| 初回セットアップ | ≤ 60分 | UX フロー計測 |
| 同時接続数 | 100 アクティブユーザー | Load Testing |

### 可用性要件

| 項目 | 要件 | SLO |
|------|------|-----|
| サービス稼働率 | 99.5% | 月次計測 |
| データ保持 | 99.99% | バックアップ戦略 |
| 復旧時間 | ≤ 4時間 | RTO |
| データ損失許容 | ≤ 1時間 | RPO |

### セキュリティ要件

- **認証**: Supabase Auth（メール/パスワード）
- **認可**: Row Level Security（RLS）ベースのマルチテナント
- **データ保護**: HTTPS必須、機密情報は環境変数管理
- **アクセス制御**: 
  - セルフサーブ：created_by 1:1 保護
  - 代理店：partner ロールでの適切な権限分離

### スケーラビリティ要件

- **水平スケーリング**: Vercel Auto-scaling
- **データベース**: Supabase Connection Pooling
- **ストレージ**: Supabase Storage（ファイルアップロード）
- **CDN**: Vercel Edge Network

### 監視・運用要件

- **エラー監視**: Sentry統合
- **パフォーマンス**: Vercel Analytics + Core Web Vitals
- **診断エンドポイント**: 
  - `/api/health` - ヘルスチェック
  - `/api/diag/session` - セッション診断
  - `/ops/verify` - 管理者向け総合診断
- **ログ**: 構造化ログ（JSON）+ Slack通知

### 互換性要件

- **ブラウザ**: Chrome 100+, Firefox 100+, Safari 15+, Edge 100+
- **モバイル**: iOS Safari 15+, Android Chrome 100+
- **レスポンシブ**: 320px〜2560px対応
- **アクセシビリティ**: WCAG 2.1 AA準拠（主要機能）

### コンプライアンス要件

- **個人情報保護**: メールアドレスの適切な管理
- **データローカライゼーション**: 日本国内データセンター使用
- **監査ログ**: 企業データの作成・更新・公開履歴
- **利用規約**: 企業による自己責任での公開内容管理

### 環境要件

| 環境 | 用途 | ドメイン | 特記事項 |
|------|------|----------|----------|
| Production | 本番運用 | aiohub.jp | SSL必須、コミットバッジ非表示 |
| Development | 開発・検証 | *.vercel.app | デバッグ機能有効 |

### 災害復旧計画

- **バックアップ**: Supabase自動バックアップ（Point-in-time Recovery）
- **フェイルオーバー**: Supabase Multi-AZ構成
- **データ復旧**: 24時間以内の任意時点復旧
- **代替手段**: 静的サイト生成による緊急公開機能

---

この要件定義書は、以後のすべての実装・テスト・運用の基準となります。要件に反する実装は受け入れ不可とし、PRレビューで必ず確認してください。