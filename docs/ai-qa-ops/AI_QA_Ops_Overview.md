# AI-QA Ops 概要（AIOHub 開発運用方針）

## 1. 前提・背景

### 開発体制の前提
- **AIOHub** は「人間 1人 + 複数 AI」で開発・運用していく前提
- 1億ユーザー規模 / 国際展開を見据えた設計
- Supabase 側は大規模・堅牢設計に寄せている
  - RLS（Row Level Security）による認可制御
  - 適切なインデックス設計
  - レート制限・DDoS対策
  - データベーススキーマの冗長性対応

### 技術スタック
- **フロントエンド**: Next.js 15 + TypeScript
- **バックエンド**: Supabase（PostgreSQL + Auth + Storage）
- **テスト**: Playwright（E2E） + Jest（Unit/Integration）
- **CI/CD**: GitHub Actions
- **監視**: 将来的に Sentry / Datadog 等を検討

---

## 2. リスク認識

### AI開発における本質的リスク

AIだけに開発を任せると **必ず重大なバグが起きる** 理由：

#### コンテキストの断絶
- 過去のルールや設計思想を忘れて別の場所を壊す
- 複数のファイルにまたがる依存関係を見落とす
- 既存の認証・認可ルールを無視した実装をしてしまう

#### ライブラリ仕様変更への追従不足
- Next.js / Supabase 等のアップデートに伴う破壊的変更
- TypeScript型定義の変更によるコンパイルエラー
- 非推奨APIの使用継続

#### 実運用での異常ケース対応不足
- 異常データ・悪意あるアクセスへの耐性不足
- エッジケースでのエラーハンドリング不備
- パフォーマンス劣化やメモリリークの見落とし

### 基本方針: 「バグ前提の堅牢性」

- **「バグゼロ」は不可能** であることを前提とする
- **「バグが出てもサービスが死なない仕組み」** を構築する
- 多層防御により、重大な問題の本番流出を防ぐ

---

## 3. 目指す開発体制（AI-QA Ops）

### AI役割分離の原則

#### 実装担当AI（Coder）
- **役割**: 仕様に基づいてコードを書く
- **使用AI**: Claude Code / Gemini / GitHub Copilot
- **特徴**: 創造性・実装速度を重視

#### 監査担当AI（Reviewer）
- **役割**: コード品質・セキュリティ・設計整合性をチェック
- **使用AI**: GPT-4o / Claude-3.5-Sonnet（実装とは別のAI）
- **特徴**: 客観性・批判的思考を重視

### 人間の役割の明確化

- **CTO的な意思決定**: アーキテクチャ方針・技術選択
- **AIへのプロンプト設計**: 効果的な指示出し・制約設定
- **最終品質判断**: AI監査結果の解釈・リスク受容判断
- **インシデント対応**: 本番障害時の迅速な意思決定

---

## 4. 3層の防御レイヤー

### 第1層: 実装（Coder Layer）
- **担当**: Claude Code / Gemini 等の実装特化AI
- **役割**: 仕様書に基づく高品質なコード生成
- **チェック内容**:
  - TypeScript型安全性
  - 基本的なコーディング規約準拠
  - 既存パターンとの整合性

### 第2層: 監査（AI Gatekeeper Layer）
- **担当**: GPT-4o 等の監査特化AI
- **実装**: GitHub Actions + OpenAI API
- **チェック内容**:
  - **認証・認可**: RLS規則の破壊検出
  - **セキュリティ**: SQLインジェクション・XSS対策
  - **UI/UX**: レイアウト破壊・アクセシビリティ
  - **パフォーマンス**: N+1クエリ・メモリリーク

### 第3層: 検品（Spec-Driven Testing Layer）
- **仕組み**: 日本語仕様書 → 自動テスト生成
- **実装**: Playwright（E2E） + Jest（Unit）
- **カバレッジ**:
  - 重要ビジネスフロー（ログイン→ダッシュボード表示等）
  - 決済・課金機能の完全性
  - 管理者機能の権限制御

---

## 5. 日本語運用ルール

### ドキュメント・仕様書
- **仕様書**: 日本語で記述（`/specs` ディレクトリ）
- **設計書**: 日本語で記述（`/docs` ディレクトリ）
- **運用Runbook**: 日本語で記述

### コード・コミット
- **変数名・関数名**: 英語（国際的な可読性のため）
- **コメント**: 複雑なロジックは日本語許容
- **PRテンプレート**: 日本語前提で運用
- **コミットメッセージ**: 日本語OK（feat: ユーザー認証機能追加）

### 理由
- 開発チームが日本人中心の場合、ドメイン知識の正確な伝達が最優先
- ビジネスロジックの微妙なニュアンスを英語で表現するリスクを回避
- AIに対する指示も日本語の方が精密に伝わる

---

## 6. 今やらないこと

### 現在の制約事項

#### CLAUDE.mdの全面書き換え延期
- 理由: Supabase側の改修とコードの整理が優先
- 時期: TypeScriptエラー解決・RLS調整完了後に実施

#### CI/GitHub Actionsの即座変更なし
- 理由: 現行の8つのワークフローが安定稼働中
- 方針: まずは設計ドキュメント化を完了してから段階導入

#### 大規模リファクタリングの回避
- 理由: 現在のコードベースが本番稼働中
- 方針: 漸進的改善・後方互換性維持を重視

---

## 7. 成功指標（KPI）

### 開発効率
- **コードレビュー時間**: 人間によるレビュー時間 50%削減
- **バグ検出率**: AI監査による本番バグ流出 80%削減
- **開発速度**: 機能追加サイクル 30%短縮

### 品質指標
- **テストカバレッジ**: E2Eテスト 80%以上維持
- **パフォーマンス**: Core Web Vitals スコア 90点以上維持
- **セキュリティ**: 脆弱性ゼロリリース 95%以上

### 運用安定性
- **アップタイム**: 99.9%以上維持
- **インシデント解決時間**: 平均30分以内
- **ロールバック成功率**: 100%

---

*本ドキュメントは AIOHub プロジェクトの AI-QA Ops 設計思想を定義するものであり、今後の実装方針の基礎となります。*