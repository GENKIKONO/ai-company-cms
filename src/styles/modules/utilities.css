/* ============================================================
   Utilities Module
   Helper classes, text utilities, responsive helpers, and mobile optimizations
   ============================================================ */

/* 1. Image and Media Overflow Prevention */
img, svg, video {
  max-width: 100%;
  height: auto;
}

/* CLS Prevention - Layout Shift Minimization */
img, video {
  height: auto;
  max-width: 100%;
}

/* All images and media - prevent overflow at source */
img, video, iframe, object, embed, svg {
  max-width: 100% !important;
  height: auto !important;
  object-fit: cover;
}

/* 2. Line Clamp Utilities */
.line-clamp-2 {
  overflow: hidden;
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 2;
}

.line-clamp-3 {
  overflow: hidden;
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 3;
}

/* 3. Natural Japanese Line-wrapping Defaults */
:root {
  --heading-balance: balance;
  --body-wrap: pretty;
  text-wrap: pretty; /* Global default for natural text wrapping */
}

/* 4. Mobile Horizontal Scroll Prevention and Font Optimization */
html, body {
  font-feature-settings: 'kern' 1, 'liga' 1, 'calt' 1;
  text-rendering: optimizeLegibility;
  word-break: keep-all;         /* Don't break in middle of words */
  overflow-wrap: anywhere;      /* Safe line wrapping at line end */
  text-wrap: var(--body-wrap);  /* Paragraphs flow naturally */
  /* Mobile horizontal scroll prevention - CRITICAL FIX */
  max-width: 100%;
  overflow-x: hidden !important;          /* Physically prohibit horizontal overflow */
  overscroll-behavior-x: none; /* Prevent horizontal bounce/chain scrolling */
  touch-action: pan-y;         /* Don't pass horizontal gestures to page (vertical scroll only) */
}

/* Main content container - prevent overflow inheritance */
main {
  max-width: 100%;
  overflow-x: hidden;
}

/* 5. Japanese Typography Utilities */

/* Heading exclusive: balance line breaks + character compression - manual break override protection */
.jp-heading {
  text-wrap: balance;
  text-align: left;
  letter-spacing: 0.01em;
}

/* Large text/paragraph exclusive: balance line breaks with widow prevention */
.jp-body {
  text-wrap: pretty;
  text-align: left;
  line-height: var(--line-height-relaxed);
}

/* Short text/button specialized: absolute no-wrap */
.jp-nowrap {
  white-space: nowrap !important;
  word-break: keep-all !important;
}

/* Japanese text utilities to prevent unnatural breaks */
.jp-avoid-break {
  white-space: nowrap;
  word-break: keep-all;
}

/* 6. Text Overflow and Ellipsis */
.text-ellipsis {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  display: inline-block;
  max-width: 100%;
}

/* 7. Safe Area and Mobile Optimizations */
/* FAB safe area */
.fab-safe-bottom {
  padding-bottom: calc(112px + env(safe-area-inset-bottom));
}

/* FAB content area - bottom content */
.ui-bottom-content {
  padding-bottom: calc(88px + env(safe-area-inset-bottom));
}

/* FAB positioning */
.fab-position {
  bottom: calc(env(safe-area-inset-bottom) + 80px);
  z-index: 60;
}

/* Safe area padding adjustments */
.safe-area-padding {
  padding-bottom: calc(env(safe-area-inset-bottom) + 88px);
}

/* 8. Responsive Text Sizing with Clamp */
.text-clamp-sm {
  font-size: clamp(0.875rem, 2.5vw, 1rem);
}

.text-clamp-base {
  font-size: clamp(1rem, 3vw, 1.125rem);
}

.text-clamp-lg {
  font-size: clamp(1.125rem, 3.5vw, 1.25rem);
}

.text-clamp-xl {
  font-size: clamp(1.25rem, 4vw, 1.5rem);
}

.text-clamp-2xl {
  font-size: clamp(1.5rem, 5vw, 2rem);
}

.text-clamp-3xl {
  font-size: clamp(1.875rem, 6vw, 2.5rem);
}

.text-clamp-4xl {
  font-size: clamp(2.25rem, 7vw, 3rem);
}

/* 9. Responsive Spacing with Clamp */
.space-clamp-sm {
  gap: clamp(0.5rem, 2vw, 1rem);
}

.space-clamp-md {
  gap: clamp(1rem, 3vw, 1.5rem);
}

.space-clamp-lg {
  gap: clamp(1.5rem, 4vw, 2rem);
}

.section-pad {
  padding-inline: clamp(1.25rem, 2vw, 2rem);
}

/* 10. Card Icon Positioning Utilities */
.card-icon-top-right {
  position: absolute;
  top: 1rem;
  right: 1rem;
  transform: translateY(0);
}

.card-icon-center {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.card-icon-static {
  position: static;
  margin: 0 auto 1rem auto;
  transform: none;
}

/* 11. Focus and Interaction Utilities */

/* Focus-visible only styling - hide outlines except for keyboard navigation */
.focus-clean:focus {
  outline: none;
  box-shadow: none;
}

.focus-clean:focus-visible {
  outline: 2px solid transparent;
  box-shadow: 0 0 0 2px rgb(99 102 241 / 0.5);
}

/* Header logo no selection */
.logo-no-select {
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  -webkit-tap-highlight-color: transparent;
}

.logo-no-select:focus {
  outline: none !important;
  box-shadow: none !important;
}

/* 12. Mobile Component Classes */

/* Mobile section wrapper for consistent spacing */
.section-mobile {
  @apply w-full max-w-[680px] mx-auto px-4 sm:px-0;
}

/* Contact cards standardized dimensions */
.contact-card-unified {
  @apply min-h-[64px] px-5 rounded-xl flex items-center;
}

.contact-icon-unified {
  @apply w-5 h-5 mr-2;
}

/* Mobile menu alignment */
.menu-item-unified {
  @apply h-12 pl-4 flex items-center text-[15px] truncate;
}

/* 13. Overflow and Scroll Utilities */
/* Mobile horizontal scroll prevention for specific elements */
.prevent-horizontal-scroll {
  max-width: 100%;
  overflow-x: hidden !important;
  overscroll-behavior-x: none;
  touch-action: pan-y;
}

/* Carousel container optimization - prevent page overflow */
.carousel-container {
  width: 100%;
  max-width: 100%;
  overflow: hidden; /* Container itself never overflows */
  position: relative;
}

/* Horizontal scrolling utilities */
.scroll-horizontal {
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  -webkit-overflow-scrolling: touch;
}

/* 14. Measure and Reading Width */
.measure-card { 
  max-width: 35ch; 
}

.measure-30 { 
  max-width: 30ch; 
}

.measure-34 { 
  max-width: 34ch; 
}

.measure-36 { 
  max-width: 36ch; 
}

/* 15. Number and Data Display */
.tabular-nums {
  font-variant-numeric: tabular-nums;
}

.lining-nums {
  font-variant-numeric: lining-nums;
}

.tabular-lining {
  font-variant-numeric: tabular-nums lining-nums;
}

/* 16. Button Text Utilities (Prevent breaking) */
.cta-nowrap,
.btn-nowrap { 
  white-space: nowrap; 
  word-break: keep-all; 
}

/* Button text optimization: lightweight no-wrap */
.btn-text-safe {
  white-space: nowrap;
  word-break: keep-all;
}

/* 17. Performance and GPU Acceleration */
.gpu-accelerated {
  transform: translateZ(0);
  backface-visibility: hidden;
  perspective: 1000px;
}

/* Common elements that benefit from GPU acceleration */
.will-change-transform {
  will-change: transform;
}

.will-change-auto {
  will-change: auto;
}

/* 18. Hit Target Utilities */
.hit-44 {
  min-height: 44px !important;
  min-width: 44px !important;
}

/* 19. Text and Content Utilities */
/* Prevent text selection */
.no-select {
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}

/* Force text visibility */
.force-visible {
  opacity: 1 !important;
  visibility: visible !important;
  display: block !important;
}

/* 20. Accessibility Utilities */
/* Screen reader only */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* 21. Mobile-specific Responsive Adjustments */
@media (max-width: 768px) {
  .mobile-stack {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  
  .mobile-center {
    text-align: center;
  }
  
  .mobile-hidden {
    display: none;
  }
  
  .mobile-full-width {
    width: 100% !important;
  }
}

@media (min-width: 769px) {
  .desktop-hidden {
    display: none;
  }
  
  .desktop-inline {
    display: inline-flex;
    gap: 1rem;
  }
}

/* 22. Avatar Size Utilities for LetterAvatar optimization */
.avatar-size-xs {
  width: 24px;
  height: 24px;
  font-size: 10px;
}

.avatar-size-sm {
  width: 32px;
  height: 32px;
  font-size: 13px;
}

.avatar-size-md {
  width: 48px;
  height: 48px;
  font-size: 19px;
}

.avatar-size-lg {
  width: 64px;
  height: 64px;
  font-size: 26px;
}

.avatar-size-xl {
  width: 80px;
  height: 80px;
  font-size: 32px;
}

/* 23. Progress Bar Utilities for Charts and Stats */
.progress-bar {
  transition: height 0.3s ease;
  opacity: 0.8;
}

.progress-bar:hover {
  opacity: 1;
}

/* 24. Hero Background Utilities for Dynamic Images */
.hero-bg-overlay {
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  border-radius: 16px;
}

.hero-bg-gradient::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4));
  border-radius: inherit;
  pointer-events: none;
}

/* 25. AI Badge Utilities for Consistent Display */
.ai-badge {
  display: inline-flex;
  align-items: center;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.ai-badge-primary {
  background-color: var(--color-primary-blue);
  color: white;
}

.ai-badge-error {
  background-color: var(--color-error);
  color: white;
}

/* 26. Comparison Card Utilities */
.comparison-card {
  padding: 24px;
  border-radius: 12px;
  border: 1px solid var(--border-light);
  background: var(--bg-white);
}

.comparison-card-success {
  @extend .comparison-card;
  border-color: var(--color-success);
}

.comparison-card-error {
  @extend .comparison-card;
  border-color: var(--color-error);
}

/* 27. Responsive Hero Text Utilities */
.hero-title {
  font-size: clamp(32px, 5vw, 64px);
  font-weight: 700;
  line-height: 1.1;
  margin-bottom: 24px;
}

.hero-subtitle {
  font-size: 20px;
  line-height: 1.5;
  margin-bottom: 32px;
}

/* 28. CTA Box Utilities for Final CTAs */
.cta-box {
  text-align: center;
  padding: 48px 40px;
  background-color: var(--bg-white);
  border-radius: 20px;
  box-shadow: 0 6px 24px rgba(0, 0, 0, 0.08);
  border: 1px solid rgba(0, 0, 0, 0.05);
}

.cta-box-large {
  padding: 64px 40px;
  border-radius: 24px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
}

/* 29. UnifiedCTA Variants for Reduced Inline Styles */
.unified-cta-primary {
  background: var(--color-primary-blue) !important;
  color: var(--bg-white) !important;
  border: none;
  box-shadow: 0 4px 12px rgba(var(--shadow-primary), 0.3);
}

.unified-cta-primary:hover {
  background: var(--color-primary-blue-hover) !important;
  transform: translateY(-2px) scale(1.02);
  box-shadow: 0 8px 24px rgba(var(--shadow-primary), 0.4);
}

.unified-cta-secondary {
  background: var(--bg-white) !important;
  color: var(--text-primary) !important;
  border: 1px solid rgba(var(--shadow-black), 0.1);
  box-shadow: 0 1px 3px rgba(var(--shadow-black), 0.1);
}

.unified-cta-secondary:hover {
  background: rgba(var(--shadow-black), 0.05) !important;
  transform: translateY(-1px) scale(1.02);
  box-shadow: 0 4px 12px rgba(var(--shadow-black), 0.15);
}